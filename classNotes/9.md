[Lezione9.pdf](/slides/)

# Java Persistence API

## Introduzione
- Le applicazioni sono fatte di logica, interazioni con altri sistemi, user interfaces, etc...
    - ma anche di dati
- I DB assicurano la persistenza dei dati
- I dati sono di solito memorizzati (in DB) reperiti ed analizzati
    - tabelle, righe, colonne, chiavi primarie, indici, join...
- ... vocabolario completamente diverso da quello dei linguaggi di programmazione OO
    - classi, variabili, riferimenti, metodi, attributi...
<br><br>
- la differenza: **la persistenza**
    - quando il Garbage Collector decide di eliminare un elemento, è perso per sempre!.
    - i database sono invece persistenti.

## Specifiche di JPA
- Creato con Java EE 5 per portare il modello OO e i DB
- JPA è un'astrazione su JDBC che lo rende indipendente da SQL
- Contenuto nel package javax.persistence
- Definisce l'Object-Relational Mapping
- Possiamo interrogare il DB con il linguaggio Java Persistence Query Language.

### Cos'è un'entità
- **un oggetto** è un'istanza di una classe che risiede in memoria e ha vita breve
- **un'entità** è persistentemente in un database.
    - in POJO è una classe particolare annotata con @javax.persistence.Entity
        - con un costruttore senza argomenti

```Java
@Entity
public class Book {
    @Id @GeneratedValue
    private Long id;
    private String title;
    private Float price;
    private String description;
    private String isbn;

    //...
}
```
- Come fa questa classe ad essere mappata in una tabella?
    - Grazie alle annotazioni.

## Ruolo dei metadati in ORM
- Configuration By Exception: importante tecnica in cui le regole di default vengono applicate dal container, se non altrimenti specificate.
- Anche conosciuta come convention over configuration
- Fornire una configurazione (personalizzazione) rappresenta un'eccezione alla regola.
- Con questa tecnica, il POJO di Book diventa:

```Java

```
### mapping di Book

## Come fare le Query di Entità
- JPA permette di assegnare entità a DB e di fare query su di loro.
    - sfruttando il linguaggio Java (non SQL)
- Per orchestrare il tutto serve un EntityManager per le operazioni CRUD.

```Java
EntityManagerFactory emf = Persistence.createEntityManagerFactory("chapter04PU")

EntityManager //...
```

## Ruolo di EntityManager

### Esempio di Query
- L'EntityManager permette di fare query
- In questo caso una query è simile ad un database query ma viene eseguita usando JPQL e non solo SQL
- Es: tutti i libri col titolo H2G2

SELECT b FROM Book b WHERE b.title = 'H2G2'
- title è un attributo di classe, non un nome di tabella